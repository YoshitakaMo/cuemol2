name: Build and release

on:
  push:

###############################################

env:
  PYTHON_VERSION: 2.7

jobs:
  build_mac_arm64:
    name: "MacOS 14 arm64 clang"
    runs-on: macos-14
    steps:
    - uses: actions/checkout@v4

    - name: Run sccache-cache
      uses: mozilla-actions/sccache-action@v0.0.4

    - name: Install python2
      shell: bash
      env:
        SCCACHE_GHA_ENABLED: "true"
      run: |
        brew install python@2

    # - name: Install deplibs and build libcuemol2
    #   shell: bash
    #   env:
    #     SCCACHE_GHA_ENABLED: "true"
    #   run: |
    #     cd ${GITHUB_WORKSPACE}
    #     bash build_scripts/build_libcuemol2_macos.sh $HOME ${{ runner.arch }}

    - name: Build UXP GUI
      shell: bash
      env:
        SCCACHE_GHA_ENABLED: "true"
      run: |
        cd ${GITHUB_WORKSPACE}
        which python
        bash build_scripts/build_uxpgui_macos.sh $HOME ${{ runner.arch }}

  build_mac_intel:
    name: "MacOS 12 intel clang"
    runs-on: macos-12
    steps:
    - uses: actions/checkout@v4

    - name: Run sccache-cache
      uses: mozilla-actions/sccache-action@v0.0.4

    - name: Install deplibs and build libcuemol2
      shell: bash
      env:
        SCCACHE_GHA_ENABLED: "true"
      run: |
        sccache -s
        cd ${GITHUB_WORKSPACE}
        bash build_scripts/build_libcuemol2_macos.sh $HOME ${{ runner.arch }}

